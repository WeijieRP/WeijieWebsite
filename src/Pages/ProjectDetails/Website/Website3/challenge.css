/* challenge.css — Project Foresight Problem & Insights
   - Uses global tokens: --body-ink, --body-muted, --titleA..D
   - No :root overrides
   - Root class: .challenge-stage (no conflict with other sections)
*/

/* Component-level wrapper */
.challenge-stage {
  --accent: #67d3ff;
  --accentSoft: rgba(103, 211, 255, 0.12);
  --line: rgba(103, 211, 255, 0.38);
  --padX: clamp(16px, 5vw, 6vw);

  position: relative;
  background: #000; /* full-bleed dark */
  overflow: hidden;
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
}

/* Height + layer isolation */
.ch-viewport {
  position: relative;
  min-height: 92vh;
  isolation: isolate;
  overflow: clip;

  /* scroll vars (updated by JS) */
  --scroll-scale: 1;
  --scroll-ty: 0px;
  --stars-tx: 0;
  --stars-ty: 0;
  --stars-rot: 0deg;

  /* reveal timing */
  --slide-dist: 28px;
  --reveal-dur: 0.55s;
  --reveal-ease: cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* —— Full-bleed Backdrop —— */
.ch-bg {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: 50% 50%;
  transform-origin: 50% 45%;
  z-index: 0;
  filter: saturate(1.05) contrast(1.05) brightness(0.95);
}

.kb-layer {
  --kb-scale: 1.05;
  animation: ch-kb 18s ease-in-out infinite alternate;
  transform: translate3d(0, var(--scroll-ty), 0)
    scale(calc(var(--scroll-scale) * var(--kb-scale)));
}

@keyframes ch-kb {
  0% {
    --kb-scale: 1.03;
    background-position: 48% 52%;
  }
  50% {
    --kb-scale: 1.09;
    background-position: 52% 48%;
  }
  100% {
    --kb-scale: 1.12;
    background-position: 50% 50%;
  }
}

/* Stars overlay */
.ch-stars {
  position: absolute;
  inset: -20%;
  background-image:
    radial-gradient(2px 2px at 22% 30%, rgba(255, 255, 255, 0.9), transparent 50%),
    radial-gradient(1.6px 1.6px at 70% 70%, rgba(255, 255, 255, 0.7), transparent 50%),
    radial-gradient(1.5px 1.5px at 85% 25%, rgba(255, 255, 255, 0.6), transparent 50%),
    radial-gradient(1.9px 1.9px at 35% 80%, rgba(255, 255, 255, 0.8), transparent 50%),
    radial-gradient(1.2px 1.2px at 10% 60%, rgba(255, 255, 255, 0.6), transparent 50%);
  opacity: 0.33;
  transform: translate(var(--stars-tx), var(--stars-ty)) rotate(var(--stars-rot));
  transition: transform 16ms linear;
  z-index: 1;
}

/* Tint / readability */
.ch-overlay {
  position: absolute;
  inset: 0;
  z-index: 2;
  pointer-events: none;
  background:
    linear-gradient(
      180deg,
      rgba(0, 0, 0, 0.52) 0%,
      rgba(0, 0, 0, 0.18) 35%,
      rgba(0, 0, 0, 0.66) 100%
    ),
    radial-gradient(
      60rem 40rem at 50% 12%,
      rgba(126, 141, 254, 0.18),
      rgba(0, 0, 0, 0) 60%
    );
}

/* —— Centered content —— */
.ch-inner {
  position: relative;
  z-index: 3;
  color: var(--body-ink); /* global warm peach */
  display: grid;
  grid-template-columns: 1fr 1fr;
  align-items: center;
  justify-items: center;
  gap: clamp(20px, 4.6vw, 56px);
  padding: clamp(44px, 7vw, 108px) var(--padX);
  width: min(1140px, 92%);
  margin: 0 auto;
}

/* Each column stretches its child */
.ch-col {
  width: 100%;
  display: flex;
  align-items: stretch;
  justify-content: center;
  max-width: 560px;
}

/* Hero card (slight glass, but text stays crisp) */
.ch-hero-card {
  border-radius: 20px;
  padding: clamp(18px, 2.6vw, 28px);
  background: linear-gradient(
    180deg,
    rgba(255, 255, 255, 0.1),
    rgba(255, 255, 255, 0.05)
  );
  border: 1px solid rgba(255, 255, 255, 0.24);
  box-shadow:
    0 10px 26px rgba(0, 0, 0, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.04) inset;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  width: 100%;
}

/* Typography */
.ch-eyebrow {
  margin: 0 0 8px;
  letter-spacing: 0.28em;
  text-transform: uppercase;
  color: #e8dfcf;
  opacity: 0.9;
  font-size: clamp(10px, 1.1vw, 14px);
}

/* h2 gradient from global .title-aurora; here only spacing/size */
.ch-title {
  margin: 0.1em 0 0.25em;
  line-height: 0.95;
  font-weight: 900;
  font-size: clamp(30px, 5.2vw, 64px);
  text-shadow:
    0 1px 0 rgba(0, 0, 0, 0.6),
    0 0 32px rgba(0, 0, 0, 0.45);
}

/* Summary uses global muted palette */
.ch-summary {
  margin: 8px 0 0;
  color: var(--body-muted);
  font-weight: 600;
  font-size: clamp(14px, 1.9vw, 19px);
}

/* Right-side figure */
.ch-figure {
  width: 100%;
  border-radius: 18px;
  overflow: clip;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(0, 0, 0, 0.4);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
  display: grid;
  grid-template-rows: 1fr auto;
}

.ch-figure--fill {
  min-height: 420px;
}

.ch-media {
  width: 100%;
  height: 100%;
}

.ch-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transform: translateZ(0);
}

.ch-cap {
  margin: 0;
  padding: 10px 12px;
  font-size: 12px;
  color: var(--body-muted);
  border-top: 1px solid rgba(255, 255, 255, 0.12);
  text-align: center;
}

.ch-figure:hover {
  transform: translateY(2px) scale(1.005);
  transition:
    transform 0.6s cubic-bezier(0.22, 0.61, 0.36, 1),
    box-shadow 0.3s ease;
  box-shadow:
    0 18px 36px rgba(0, 0, 0, 0.5),
    0 0 18px rgba(103, 211, 255, 0.18);
}

/* ===== Scroll reveal ===== */
[data-reveal] {
  opacity: 0;
  transform: translateX(0) translateY(8px);
  transition:
    opacity var(--reveal-dur) var(--reveal-ease),
    transform var(--reveal-dur) var(--reveal-ease);
  will-change: opacity, transform;
}

[data-reveal][data-dir="left"] {
  transform: translateX(calc(-1 * var(--slide-dist))) translateY(8px);
}

[data-reveal][data-dir="right"] {
  transform: translateX(var(--slide-dist)) translateY(8px);
}

.is-shown[data-reveal] {
  opacity: 1;
  transform: translateX(0) translateY(0);
}

/* Responsive */
@media (max-width: 980px) {
  .ch-inner {
    grid-template-columns: 1fr;
  }
  .ch-col {
    max-width: 760px;
  }
  .ch-figure--fill {
    min-height: 360px;
  }
}

@media (max-width: 560px) {
  .ch-figure--fill {
    min-height: 300px;
  }
}

/* Motion safety */
@media (prefers-reduced-motion: reduce) {
  .kb-layer {
    animation: none !important;
    transform: none !important;
  }
  .ch-stars {
    transition: none !important;
    transform: none !important;
  }
  [data-reveal] {
    opacity: 1 !important;
    transform: none !important;
    transition: none !important;
  }
}
